# Yisin 测试指南

## 🧪 测试前准备

### 1. 获取 Gemini API Key

访问：https://makersuite.google.com/app/apikey

1. 登录 Google 账号
2. 点击 "Create API Key"
3. 复制生成的 API Key

### 2. 在 Xcode 中运行

1. 确保 Xcode 已打开 `Package.swift`
2. 等待依赖解析完成（首次打开需要几秒钟）
3. 选择 `Yisin` scheme（左上角）
4. 点击运行按钮或按 `⌘R`

---

## ✅ 测试清单

### 测试 1: 应用启动

**预期结果**:
- ✅ 应用启动后，菜单栏右上角出现 Yisin 图标（两条优雅的曲线）
- ✅ Dock 栏中**没有** Yisin 图标（背景化设计）
- ✅ 可能会弹出辅助功能权限请求

**如果出现权限请求**:
1. 点击"打开系统设置"
2. 在"隐私与安全性 > 辅助功能"中找到 Yisin
3. 勾选启用
4. 重启应用（在 Xcode 中停止后重新运行）

---

### 测试 2: 设置界面

**操作**:
1. 点击菜单栏的 Yisin 图标
2. 选择"设置"

**预期结果**:
- ✅ 打开一个 500x600 的设置窗口
- ✅ 界面采用 MUJI 极简风格
- ✅ 顶部显示 Yisin Logo
- ✅ 包含以下部分：
  - API 配置（SecureField）
  - 快捷键设置
  - 提示词编辑器
  - 历史记录开关

**测试 API Key 配置**:
1. 在"Gemini API Key"字段粘贴您的 API Key
2. 字段应该显示为密码形式（圆点）
3. 关闭设置窗口
4. 重新打开设置
5. ✅ API Key 应该被保存（显示为圆点）

---

### 测试 3: 快捷键录制

**操作**:
1. 在设置窗口中找到"快捷键"部分
2. 点击"录制"按钮
3. 按下一个组合键（如 `⌘⌥T`）

**预期结果**:
- ✅ 录制按钮变为"取消"，文字变蓝
- ✅ 输入框显示蓝色边框
- ✅ 按下组合键后，显示为 "⌘ ⌥ T" 格式
- ✅ 自动停止录制

**注意**:
- 必须包含修饰键（⌘ ⇧ ⌥ ⌃）
- 避免使用系统快捷键（如 ⌘Q, ⌘W）

---

### 测试 4: 文本捕获（核心功能）

**准备**:
1. 确保已配置 API Key
2. 确保已授予辅助功能权限
3. 打开任意文本编辑器（如 Notes、TextEdit、浏览器）

**测试英文 → 中文**:
1. 在文本编辑器中输入：`Hello, this is a test.`
2. 选中这段文本
3. 按下快捷键（默认 `⌘⇧T`）

**预期结果**:
- ✅ 菜单栏图标变为蓝色呼吸动画（聆听状态）
- ✅ 图标变为旋转圆环（思考状态）
- ✅ 在鼠标附近弹出"光窗"
- ✅ 光窗显示：
  - 上部：`EN` 标签 + 原文
  - 分隔线
  - 下部：`中文` 标签 + 翻译结果
- ✅ 图标短暂变绿（完成状态）
- ✅ 图标恢复静态（待机状态）

**测试中文 → 英文**:
1. 输入：`你好，这是一个测试。`
2. 选中并按快捷键

**预期结果**:
- ✅ 自动检测为中文
- ✅ 翻译为英文
- ✅ 标签显示为 `中文` → `EN`

---

### 测试 5: 光窗交互

**测试窗口定位**:
1. 在屏幕不同位置选中文本并翻译
2. ✅ 光窗应该始终在鼠标附近
3. ✅ 不会超出屏幕边界

**测试复制功能**:
1. 翻译完成后，点击翻译结果区域
2. ✅ 显示"已复制"提示（绿色，1.5秒后消失）
3. 在其他地方粘贴（⌘V）
4. ✅ 应该粘贴翻译结果

**测试关闭**:
- 方法 1: 按 `ESC` 键
- 方法 2: 点击右上角的 ❌ 按钮
- ✅ 光窗优雅淡出消失

**测试动态尺寸**:
1. 翻译短文本（5-10 字）
2. 翻译长文本（100+ 字）
3. ✅ 窗口大小应该自动调整

---

### 测试 6: 错误处理

**测试无 API Key**:
1. 在设置中清空 API Key
2. 尝试翻译
3. ✅ 应该显示错误："未配置 API Key"

**测试无效 API Key**:
1. 输入错误的 API Key
2. 尝试翻译
3. ✅ 应该显示 API 错误信息

**测试无选中文本**:
1. 不选中任何文本
2. 按快捷键
3. ✅ 应该弹出提示："未检测到选中文本"

**测试网络错误**:
1. 断开网络连接
2. 尝试翻译
3. ✅ 应该显示网络错误

---

### 测试 7: 菜单栏图标动画

**观察图标状态变化**:
1. 待机：静态的对话流动图标（灰色）
2. 聆听：呼吸动画（蓝色，缩放）
3. 思考：旋转圆环（蓝色）
4. 完成：短暂闪烁（绿色）
5. 恢复待机

**测试快速连续翻译**:
1. 快速选中多段文本并翻译
2. ✅ 图标状态应该正确切换
3. ✅ 不应该卡顿或错乱

---

## 🐛 常见问题

### 问题 1: 无法捕获文本

**解决方案**:
1. 检查辅助功能权限是否已授予
2. 系统设置 > 隐私与安全性 > 辅助功能
3. 确保 Yisin 已勾选
4. 重启应用

### 问题 2: 快捷键不响应

**解决方案**:
1. 检查快捷键是否与其他应用冲突
2. 尝试更换快捷键
3. 在 Xcode 控制台查看是否有"快捷键注册成功"的日志

### 问题 3: 翻译失败

**检查清单**:
- ✅ API Key 是否正确
- ✅ 网络连接是否正常
- ✅ Gemini API 配额是否用完
- ✅ 查看 Xcode 控制台的错误信息

### 问题 4: 光窗不显示

**解决方案**:
1. 检查是否有其他窗口遮挡
2. 尝试在不同应用中测试
3. 查看 Xcode 控制台的日志

---

## 📊 测试报告模板

测试完成后，请记录：

```
✅ 通过 / ❌ 失败

[ ] 应用启动
[ ] 权限请求
[ ] 设置界面
[ ] API Key 保存
[ ] 快捷键录制
[ ] 英文→中文翻译
[ ] 中文→英文翻译
[ ] 光窗显示
[ ] 复制功能
[ ] ESC 关闭
[ ] 图标动画
[ ] 错误处理

问题记录：
1.
2.
3.
```

---

## 🎯 性能测试

### 响应时间
- 快捷键触发 → 光窗显示：< 0.5 秒
- API 请求 → 翻译结果：1-3 秒（取决于网络）
- 光窗淡入/淡出：0.3 秒

### 内存占用
- 待机状态：< 50 MB
- 翻译过程：< 100 MB

---

**祝测试顺利！** 🍵

如有任何问题，请查看 Xcode 控制台的日志输出。
